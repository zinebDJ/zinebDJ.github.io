CKEDITOR.dialog.add("tagsDialog",function(b){var a={};var f=b.lang.tags;var c=function(){var j=b.document.$.children[0].children[1].innerHTML.replace(/<[^<>]*>/g,"").replace(/&gt;/g,">");var m=(/\{\{tag>.*?\}\}/g);var l=m.exec(j);var k=[];var h=function(o){if(l!=null){var q=new RegExp("( |>)"+o.toUpperCase()+"( |})","g");for(var p=0;p<l.length;p++){if(q.test(l[p].toUpperCase())){return true}}return false}else{return false}};jQuery.ajax(DOKU_BASE+"lib/exe/ajax.php",{data:{call:"tagapi_list"},type:"POST",async:false,dataType:"json",success:function(o,p,i){a=o.tags},error:function(i,p,o){alert(p);alert(o)}});var n={type:"hbox",children:[]};k[k.length]=n;for(var g=0;g<a.length;g++){n.children[n.children.length]={type:"checkbox",id:a[g].id,label:a[g].name,"default":a[g].name==""?"":(h(a[g].id)?"checked":""),userdef:false};if(((g%5)==4)&&((g+1)<a.length-1)){n={type:"hbox",children:[]};k[k.length]=n}}k[k.length]={type:"checkbox",id:"",label:"","default":"",userdef:false};var d=k[k.length-1];d.userdef=true;d.id="user_def_box";d.label=f.customTags;k[k.length-1]={type:"vbox",children:[d,{type:"text",id:"user_def_text"}]};return k};var e={title:f.dlgTitle,minWidth:500,minHeight:200,contents:[{id:"tab-basic",label:"Settings",elements:c()}],onOk:function(){var h=this;var k="{{tag>";var g="}}";var j="";var h=this;for(var d=0;d<a.length;d++){j+=h.getValueOf("tab-basic",a[d].id)?a[d].id+" ":""}j+=h.getValueOf("tab-basic","user_def_box")?h.getValueOf("tab-basic","user_def_text")+" ":"";j=j.replace(/\s+$/,"");b.setData(b.getData().replace(/\{\{tag&gt;.*?\}\}/g,"")+(j==""?"":k+j+g))}};return e});